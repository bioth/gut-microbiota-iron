Etape 1: DADA2

Transformer les données 16S en ASV (amplicon single variants)
+ quality filtering

-Installer bioconductor: https://bioconductor.org/install/
Requiert de taper dans R:
if (!require("BiocManager", quietly = TRUE))
    install.packages("BiocManager")
BiocManager::install(version = "3.18")

ATTENTION: la version 3.18 marche uniquement avec la version 4.3.0 de R

Pour build ce package, nécessite R tools d'installé (https://cran.r-project.org/bin/windows/Rtools/rtools43/rtools.html)

-Installer dada2:
BiocManager::install("dada2", version = "3.18")

Une fois le package installé, la documentation est accessible en utilisant
help(package="dada2")
?derepFastq
?dada
Dans le command line de R studio.


-Utiliser dada2:
For each sample, dada2 expects an individual fastq file (or 2, one forward and one reverse)
We need a set of demultiplexed fastq files
Fastq file = base format for high-throughput sequencing data, with data about the sequence of nucleotides and the quality of sequencing

Once demultiplexed fastq files without non-biological nucleotides are in hand, the dada2 pipeline proceeds as follows:

    1-Filter and trim: filterAndTrim()
    2-Dereplicate: derepFastq()
    3-Learn error rates: learnErrors()
    4-Infer sample composition: dada()
    5-Merge paired reads: mergePairs()
    6-Make sequence table: makeSequenceTable()
    7-Remove chimeras: removeBimeraDenovo()


The fastq files in uncompressed_files folders already seem to be demultiplexed, as they have as a name the "Identifiant de lecture" variable present in the "Microbiota_10_MiSeqReadSet_2020-12-08.xlsx" file. Also, at the end there is R1 or R2 which corresponds to the direction of the sequencing, as it has been sequenced in both directions. This is okay, because dada2 can accept one forward one reverse.

The only step before using dada2, is removing the non-biological bases, that is the primers etc etc... For this, cut adapt can be used.

Looking at the excel files, here are the names of the columns which seem to correspond to non-biological bases (unique counts):
-Séquence de l'amorce sens (1)
-Séquence de l'amorce antisens (1)
-Adapteur read1 (1)
-Adapteur read2 (1)

R1 and R2 both read in the 5' direction. Amorce = primer
Adapter is for attachment of the DNA fragments during cluster generation, can also serve purpose such as indexing, whereas the primer is the starting point for DNA synthesis.

In the dataset I have access to, the primers contain the adapter sequence at the start. Thus they should be the only sequences I need to remove.

By checking in more details the primers sequences, indeed they are 4 different versions of them.






Detailed steps plan:
1- Trimming of non-biological bases (removing non-biological bases => primers) using cutAdapt (for multiple primers used on a same dataset)
To install cutAdapt, follow this: https://cutadapt.readthedocs.io/en/stable/installation.html
Activate the Conda environment. This needs to be done every time you open a new shell in order to be able to use Cutadapt:
To use it => py -m cutadapt

py -m cutadapt -b file:r1_primers.fasta -o test.fastq uncompressed_file/MI.M05812_0020.001.FLD0003.15172T14_R1.fastq
Currently, bash script called "cutadapt.sh"

2-DADA2
filtering and trimming of fastq files
To determine error rates to set up the trimming and filtering parameters, can use Figaro
https://github.com/Zymo-Research/figaro#figaro
python3 figaro.py -i /path/to/fastq/directory -o /path/to/output/files -a 450 -f 20 -r 20



